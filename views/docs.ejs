<%- include('partials/header', { title: 'Documentation', pageCss: 'docs' }) %>

<div class="docs-layout">
    <div class="sidebar-overlay" id="docsOverlay"></div>

    <aside class="docs-sidebar" id="docsSidebar">
        <div class="docs-nav">
            <h3>Table of Contents</h3>
            <a href="#introduction" class="active">Introduction</a>
            <a href="#authentication">Authentication</a>
            <a href="#upload-api">Upload API</a>
            <a href="#file-management">File Management</a>
            <a href="#webhooks">Webhooks</a>
            <a href="#security-features">Security & Passkeys</a>
            <a href="#integration-tools">Integration Tools</a>
            <a href="#compliance">Compliance & Limits</a>
        </div>
    </aside>

    <main class="docs-content">
        <button class="docs-toggle-btn" id="docsToggleBtn">
            <i class="fa-solid fa-bars"></i> Menu
        </button>

        <section id="introduction">
            <h1>API Documentation</h1>
            <p>Welcome to the w-upload Developer API. Build powerful file management integrations with our secure, high-performance endpoints. Whether you are automating backups or building a custom frontend, our API provides full control.</p>
        </section>

        <section id="authentication">
            <h2><i class="fa-solid fa-key"></i> Authentication</h2>
            <p>Authenticate your requests using either a Bearer Token (JWT) or a persistent API Key.</p>
            
            <div class="feature-item">
                <strong>Method 1: Bearer Token (Browser/Session)</strong>
                <pre><code>Authorization: Bearer &lt;your_jwt_token&gt;</code></pre>
            </div>
            
            <div class="feature-item">
                <strong>Method 2: API Key (Server-to-Server)</strong>
                <pre><code>x-api-key: &lt;your_api_key&gt;</code></pre>
                <p>Generate your API Keys in the <a href="/profile">Account Settings</a> page. Treat these keys like passwords.</p>
            </div>
        </section>

        <section id="upload-api">
            <h2><i class="fa-solid fa-cloud-arrow-up"></i> Upload API</h2>
            
            <div class="api-endpoint">
                <span class="method post">POST</span> 
                <span class="url">/api/upload</span>
                <p>Upload a file using Base64 encoding. Ideal for small to medium files via JSON.</p>
                <div class="code-block">
                    <strong>Body (JSON):</strong>
<pre>{
  "filename": "image.png",
  "base64": "data:image/png;base64,iVBORw0KGgo...",
  "contentType": "image/png",
  "isPublic": true,
  "description": "Uploaded via API"
}</pre>
                </div>
            </div>
            
            <div class="api-endpoint">
                <span class="method post">POST</span> 
                <span class="url">/api/upload/remote</span>
                <p>Fetch a file directly from an external URL.</p>
                <div class="code-block">
                    <strong>Body (JSON):</strong>
<pre>{
  "url": "https://example.com/file.pdf",
  "parentId": "optional_folder_id"
}</pre>
                </div>
            </div>

            <div class="api-endpoint">
                <span class="method post">POST</span> 
                <span class="url">/api/upload/chunk/init</span>
                <p>Initialize a large file upload session.</p>
            </div>
        </section>

        <section id="file-management">
            <h2><i class="fa-solid fa-folder-tree"></i> File Operations</h2>
            
            <div class="api-endpoint">
                <span class="method post">POST</span> 
                <span class="url">/api/folder</span>
                <p>Create a new directory.</p>
                <pre>{ "name": "Backup 2024", "parentId": null }</pre>
            </div>

            <div class="api-endpoint">
                <span class="method put">PUT</span> 
                <span class="url">/api/files/:id/protect</span>
                <p>Update security settings for a file.</p>
                <pre>{
  "password": "secret123",
  "expires": 24, // hours
  "burn": "true" // true/false string
}</pre>
            </div>

            <div class="api-endpoint">
                <span class="method delete">DELETE</span> 
                <span class="url">/api/files/:id</span>
                <p>Move a file to the trash bin.</p>
            </div>
        </section>

        <section id="webhooks">
            <h2><i class="fa-solid fa-bolt"></i> Webhooks</h2>
            <p>Receive real-time HTTP POST notifications when events occur in your account. Configure your endpoint in <a href="/profile">Settings</a>.</p>
            
            <div class="feature-grid">
                <div class="feature-item">
                    <strong>Event: file.uploaded</strong>
                    <p>Triggered when a file is successfully saved.</p>
                </div>
                <div class="feature-item">
                    <strong>Event: file.deleted</strong>
                    <p>Triggered when a file is moved to trash.</p>
                </div>
            </div>

            <div class="code-block">
                <strong>Example Payload:</strong>
<pre>{
  "event": "file.uploaded",
  "timestamp": "2024-03-20T10:00:00Z",
  "data": {
    "fileId": "65f8a...",
    "filename": "document.pdf",
    "size": 102400,
    "url": "https://w-upload.com/file/doc_123"
  }
}</pre>
            </div>
            <p>Verify the request using the <code>X-Webhook-Signature</code> header (HMAC SHA256 of the body signed with your secret).</p>
        </section>

        <section id="security-features">
            <h2><i class="fa-solid fa-shield-halved"></i> Security Features</h2>
            <ul class="doc-list">
                <li><strong>Passkeys (WebAuthn):</strong> Biometric login support (FaceID/TouchID).</li>
                <li><strong>2FA (TOTP):</strong> Time-based One-Time Passwords for extra security.</li>
                <li><strong>IP Fencing:</strong> Restrict file access to specific geographical coordinates.</li>
                <li><strong>Virus Scan:</strong> Integration with VirusTotal API for malware detection.</li>
                <li><strong>Session Control:</strong> View and revoke active sessions remotely.</li>
            </ul>
        </section>

        <section id="integration-tools">
            <h2><i class="fa-solid fa-plug"></i> Integration Tools</h2>
            <div class="feature-grid">
                <div class="feature-item">
                    <strong>File Request Links</strong>
                    <p>Generate public links to let others upload directly to your folder.</p>
                </div>
                <div class="feature-item">
                    <strong>Email Sharing</strong>
                    <p>Send secure access links directly via email with custom templates.</p>
                </div>
                <div class="feature-item">
                    <strong>QR Codes</strong>
                    <p>Instantly generate QR codes for any file URL.</p>
                </div>
            </div>
        </section>

        <section id="compliance">
            <h2><i class="fa-solid fa-server"></i> Limits & Compliance</h2>
            <table class="doc-table" style="width:100%; border-collapse:collapse; margin-top:1rem;">
                <thead>
                    <tr style="text-align:left; border-bottom:2px solid var(--border);">
                        <th style="padding:10px;">Limit Type</th>
                        <th style="padding:10px;">Free Tier</th>
                        <th style="padding:10px;">Pro Tier</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="border-bottom:1px solid var(--border);">
                        <td style="padding:10px;">Max File Size</td>
                        <td style="padding:10px;">1 GB</td>
                        <td style="padding:10px;">10 GB</td>
                    </tr>
                    <tr style="border-bottom:1px solid var(--border);">
                        <td style="padding:10px;">Storage Space</td>
                        <td style="padding:10px;">1 GB</td>
                        <td style="padding:10px;">50 GB</td>
                    </tr>
                    <tr>
                        <td style="padding:10px;">API Rate Limit</td>
                        <td style="padding:10px;">100 req/hour</td>
                        <td style="padding:10px;">5,000 req/hour</td>
                    </tr>
                </tbody>
            </table>
        </section>
    </main>
</div>

<style>
    .docs-toggle-btn { margin-bottom: 2rem; }
    .sidebar-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.5); z-index: 90; display: none;
    }
    .sidebar-overlay.active { display: block; }
    .api-endpoint { background: var(--bg-secondary); padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 1.5rem; }
    .api-endpoint .method { font-weight: bold; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; margin-right: 10px; color: white; }
    .method.post { background: #22c55e; }
    .method.get { background: #3b82f6; }
    .method.put { background: #f59e0b; }
    .method.delete { background: #ef4444; }
    .api-endpoint .url { font-family: monospace; font-size: 1.1rem; font-weight: 600; color: var(--text); }
    .code-block { background: #1e1e1e; color: #d4d4d4; padding: 1rem; border-radius: 6px; overflow-x: auto; margin-top: 1rem; font-size: 0.9rem; }
    pre { margin: 0; font-family: 'Fira Code', monospace; }
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const sidebar = document.getElementById('docsSidebar');
    const toggleBtn = document.getElementById('docsToggleBtn');
    const overlay = document.getElementById('docsOverlay');

    function toggleDocsSidebar() {
        sidebar.classList.toggle('active');
        overlay.classList.toggle('active');
    }

    if(toggleBtn) toggleBtn.addEventListener('click', toggleDocsSidebar);
    if(overlay) overlay.addEventListener('click', toggleDocsSidebar);

    document.querySelectorAll('.docs-nav a').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            document.querySelectorAll('.docs-nav a').forEach(a => a.classList.remove('active'));
            this.classList.add('active');
            
            const target = document.querySelector(this.getAttribute('href'));
            if(target) {
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
            }
        });
    });

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const id = entry.target.getAttribute('id');
                document.querySelectorAll('.docs-nav a').forEach(a => a.classList.remove('active'));
                const activeLink = document.querySelector(`.docs-nav a[href="#${id}"]`);
                if(activeLink) activeLink.classList.add('active');
            }
        });
    }, { threshold: 0.1 });

    document.querySelectorAll('section').forEach((section) => {
        observer.observe(section);
    });
});
</script>

<%- include('partials/footer') %>