<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>w upload</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { --bg: #ffffff; --text: #333333; --card: #f8f9fa; --primary: #4361ee; --border: #e0e0e0; }
        [data-theme="dark"] { --bg: #0f172a; --text: #e2e8f0; --card: #1e293b; --primary: #38bdf8; --border: #334155; }
        
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; min-height: 100vh; display: flex; flex-direction: column; transition: 0.3s; }
        
        .navbar { display: flex; justify-content: space-between; padding: 1rem 2rem; background: var(--card); border-bottom: 1px solid var(--border); align-items: center; position: sticky; top: 0; z-index: 50; }
        .logo { font-weight: 800; font-size: 1.5rem; color: var(--primary); text-decoration: none; }
        .nav-links { display: flex; gap: 15px; }
        
        .main-content { flex: 1; padding: 2rem; max-width: 800px; margin: 0 auto; width: 100%; box-sizing: border-box; }
        
        .upload-card { background: var(--card); border: 2px dashed var(--border); border-radius: 16px; padding: 3rem 1rem; text-align: center; transition: 0.3s; position: relative; }
        .upload-card.drag-active { border-color: var(--primary); background: rgba(67, 97, 238, 0.1); transform: scale(1.02); }
        .upload-icon { font-size: 3rem; color: var(--primary); margin-bottom: 1rem; transition: 0.3s; }
        .drag-active .upload-icon { transform: scale(1.2); }
        
        input[type="file"] { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; z-index: 10; }
        
        .custom-url-group { margin-top: 20px; display: flex; gap: 10px; align-items: center; }
        .url-prefix { background: var(--border); padding: 12px 15px; border-radius: 8px 0 0 8px; color: var(--text); font-family: monospace; border: 1px solid var(--border); border-right: none; white-space: nowrap; }
        .input-field { flex: 1; padding: 12px; border-radius: 0 8px 8px 0; border: 1px solid var(--border); background: var(--bg); color: var(--text); outline: none; width: 100%; }
        
        .btn-action { background: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; width: 100%; margin-top: 20px; display: flex; align-items: center; justify-content: center; gap: 10px; transition: 0.2s; }
        .btn-action:hover { opacity: 0.9; }
        .btn-action:disabled { opacity: 0.6; cursor: not-allowed; }

        .progress-area { margin-top: 20px; display: none; }
        .progress-bar { height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; width: 0%; background: var(--primary); transition: width 0.1s linear; }

        .result-area { margin-top: 30px; display: none; background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid var(--border); animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .qr-container { display: flex; justify-content: center; margin: 20px 0; background: white; padding: 10px; border-radius: 8px; width: fit-content; margin-left: auto; margin-right: auto; }
        
        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 1000; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: var(--card); color: var(--text); padding: 15px 20px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); border-left: 5px solid var(--primary); display: flex; align-items: center; gap: 10px; min-width: 250px; animation: slideIn 0.3s; }
        .toast.error { border-left-color: #ef4444; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body>

<div class="toast-container" id="toastContainer"></div>

<nav class="navbar">
    <a href="/" class="logo">w upload</a>
    <div class="nav-links">
        <a href="/docs" style="color:var(--text); text-decoration:none;"><i class="fa-solid fa-book"></i> Docs</a>
    </div>
</nav>

<div class="main-content">
    <div class="upload-card" id="dropZone">
        <i class="fa-solid fa-cloud-arrow-up upload-icon"></i>
        <h3>Drag & Drop or Click</h3>
        <p id="fileNameDisplay" style="color: var(--primary); font-weight: bold; min-height: 1.2em;"></p>
        <input type="file" id="fileInput">
    </div>

    <div class="custom-url-group">
        <span class="url-prefix">w-upload/file/</span>
        <input type="text" id="customAlias" class="input-field" placeholder="auto-filename" readonly>
    </div>

    <button onclick="processUpload()" id="uploadBtn" class="btn-action">
        <i class="fa-solid fa-rocket"></i> Upload Now
    </button>

    <div class="progress-area" id="progressArea">
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        <div style="text-align:right; font-size:0.9rem; margin-top:5px;" id="statusText">0%</div>
    </div>

    <div class="result-area" id="resultArea">
        <h3 style="text-align:center; color:#22c55e;"><i class="fa-solid fa-check-circle"></i> Upload Success</h3>
        
        <input type="text" id="linkOutput" class="input-field" style="border-radius:8px; text-align:center; font-weight:bold; cursor:pointer;" readonly onclick="copyLink()">
        
        <div class="qr-container" id="qrCode"></div>

        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;">
            <button class="btn-action" style="margin:0; background:#3b82f6;" onclick="copyLink()">Copy URL</button>
            <button class="btn-action" style="margin:0; background:#64748b;" onclick="window.open(document.getElementById('linkOutput').value, '_blank')">Open</button>
        </div>
    </div>
</div>

<script>
    function updateTheme() {
        const isDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
        document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
    }
    window.matchMedia("(prefers-color-scheme: dark)").addEventListener('change', updateTheme);
    updateTheme();

    function showToast(message, type = 'success') {
        const container = document.getElementById('toastContainer');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerHTML = `<i class="fa-solid ${type === 'success' ? 'fa-check' : 'fa-circle-exclamation'}"></i> <span>${message}</span>`;
        container.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }

    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const customAliasInput = document.getElementById('customAlias');
    
    ['dragenter', 'dragover'].forEach(e => {
        dropZone.addEventListener(e, (ev) => { ev.preventDefault(); dropZone.classList.add('drag-active'); });
    });
    ['dragleave', 'drop'].forEach(e => {
        dropZone.addEventListener(e, (ev) => { ev.preventDefault(); dropZone.classList.remove('drag-active'); });
    });

    fileInput.addEventListener('change', () => {
        if(fileInput.files[0]) {
            const name = fileInput.files[0].name;
            document.getElementById('fileNameDisplay').innerText = name;
            customAliasInput.value = name; 
        }
    });

    function processUpload() {
        const file = fileInput.files[0];
        const alias = customAliasInput.value.trim();

        if (!file) return showToast('Select a file first', 'error');
        if (file.size > 16 * 1024 * 1024) return showToast('File too large (>16MB)', 'error');

        document.getElementById('uploadBtn').disabled = true;
        document.getElementById('progressArea').style.display = 'block';
        document.getElementById('resultArea').style.display = 'none';
        document.getElementById('progressFill').style.width = '0%';

        const reader = new FileReader();
        reader.onload = (e) => uploadToServer(file.name, file.type, e.target.result, alias);
        reader.readAsDataURL(file);
    }

    function uploadToServer(filename, contentType, base64, customAlias) {
        const xhr = new XMLHttpRequest();
        xhr.open("POST", "/api/upload", true);
        xhr.setRequestHeader("Content-Type", "application/json");

        xhr.upload.onprogress = (e) => {
            if (e.lengthComputable) {
                const pct = Math.round((e.loaded / e.total) * 100);
                document.getElementById('progressFill').style.width = pct + '%';
                document.getElementById('statusText').innerText = pct + '%';
            }
        };

        xhr.onload = () => {
            document.getElementById('uploadBtn').disabled = false;
            document.getElementById('progressArea').style.display = 'none';

            if (xhr.status === 200) {
                const res = JSON.parse(xhr.responseText);
                showResult(res.url);
                showToast('Upload Successful!');
            } else {
                const err = JSON.parse(xhr.responseText);
                showToast(err.message || 'Upload Failed', 'error');
            }
        };

        xhr.send(JSON.stringify({ filename, contentType, base64, customAlias }));
    }

    function showResult(url) {
        document.getElementById('resultArea').style.display = 'block';
        document.getElementById('linkOutput').value = url;
        
        const qrDiv = document.getElementById('qrCode');
        qrDiv.innerHTML = '';
        new QRCode(qrDiv, { text: url, width: 128, height: 128 });
    }

    function copyLink() {
        const el = document.getElementById("linkOutput");
        el.select();
        document.execCommand("copy");
        showToast('Link Copied!');
    }
</script>
</body>
</html>