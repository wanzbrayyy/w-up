const mongoose = require('mongoose');

const FileSchema = new mongoose.Schema({
  originalName: { type: String, required: true },
  customAlias: { type: String, required: true, unique: true },
  contentType: { type: String, required: true },
  size: { type: Number, required: true },
  base64: { type: String, required: false },
  owner: { type: mongoose.Schema.Types.ObjectId, ref: 'User', required: true },
  
  isFolder: { type: Boolean, default: false },
  parentId: { type: mongoose.Schema.Types.ObjectId, ref: 'File', default: null },
  
  downloads: { type: Number, default: 0 },
  password: { type: String },
  expiresAt: { type: Date },
  downloadLimit: { type: Number },
  
  deletedAt: { type: Date, default: null }, 
  isStarred: { type: Boolean, default: false },
  isHidden: { type: Boolean, default: false },
  tags: [{ type: String }],
  description: { type: String, default: '' },
  md5Hash: { type: String },
  
  versions: [{
    version: Number,
    base64: String,
    uploadedAt: { type: Date, default: Date.now },
    size: Number
  }],

  reports: [{
    reason: String,
    reportedAt: { type: Date, default: Date.now }
  }],
  createdAt: { type: Date, default: Date.now },
  updatedAt: { type: Date, default: Date.now }
});

FileSchema.index({ owner: 1, parentId: 1, deletedAt: 1 });
FileSchema.index({ customAlias: 1 });

module.exports = mongoose.model('File', FileSchema);